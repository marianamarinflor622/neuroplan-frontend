/* ============================================
   SISTEMA DE ACCESIBILIDAD - VERSIÓN 2 ROBUSTA
   Sin !important para permitir reset correcto
   ============================================ */

/* Variables CSS personalizadas */
:root {
  --accessibility-font-size: 100%;
  --accessibility-letter-spacing: 0px;
  --accessibility-line-height: 150%;
  --accessibility-word-spacing: 0px;
  --accessibility-contrast: 100%;
  --accessibility-saturation: 100%;
  --accessibility-brightness: 100%;
}

/* Aplicar variables de texto */
body {
  font-size: var(--accessibility-font-size);
  letter-spacing: var(--accessibility-letter-spacing);
  line-height: var(--accessibility-line-height);
  word-spacing: var(--accessibility-word-spacing);
}

/* Aplicar filtros base solo cuando no hay filtros especiales */
body:not([class*="accessibility-colorblind-"]):not(.accessibility-monochrome):not(.accessibility-inverted-contrast):not(.accessibility-high-contrast):not(.accessibility-low-brightness):not(.accessibility-high-brightness):not(.accessibility-high-saturation):not(.accessibility-low-saturation):not(.accessibility-light-contrast):not(.accessibility-dark-contrast) {
  filter: contrast(var(--accessibility-contrast)) 
          saturate(var(--accessibility-saturation)) 
          brightness(var(--accessibility-brightness));
}

/* Reset explícito para body sin clases */
body:not([class*="accessibility-"]) {
  filter: none;
}

/* ============================================
   CURSORES PERSONALIZADOS
   ============================================ */

.accessibility-cursor-black * {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"><circle cx="16" cy="16" r="10" fill="black"/></svg>') 16 16, auto;
}

.accessibility-cursor-white * {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"><circle cx="16" cy="16" r="10" fill="white" stroke="black" stroke-width="2"/></svg>') 16 16, auto;
}

/* ============================================
   GUÍA DE LECTURA
   ============================================ */

.accessibility-reading-guide::before {
  content: '';
  position: fixed;
  top: 50%;
  left: 0;
  right: 0;
  height: 2px;
  background: rgba(255, 0, 0, 0.6);
  pointer-events: none;
  z-index: 999998;
  transform: translateY(-50%);
}

/* ============================================
   LUPA/MAGNIFIER
   ============================================ */

.accessibility-magnifier *:not(button):not([role="dialog"]):not(.accessibility-trigger-wrapper):not(.accessibility-trigger-wrapper *):not(.accessibility-trigger-btn):not([aria-label*="Abrir panel"]):not([data-radix-popper-content-wrapper]):not([data-radix-popper-content-wrapper] *):hover {
  transform: scale(1.1);
  transition: transform 0.2s ease;
  z-index: 10;
  position: relative;
}

/* Excluir explícitamente el botón y tooltip de lupa */
.accessibility-magnifier .accessibility-trigger-wrapper,
.accessibility-magnifier .accessibility-trigger-wrapper *,
.accessibility-magnifier .accessibility-trigger-btn,
.accessibility-magnifier [role="tooltip"],
.accessibility-magnifier [role="tooltip"] * {
  transform: none !important;
  scale: 1 !important;
}

/* ============================================
   MODO ENFOQUE
   ============================================ */

.accessibility-focus-mode *:not(:focus):not(:focus-within) {
  filter: blur(2px);
  transition: filter 0.3s ease;
}

.accessibility-focus-mode *:focus,
.accessibility-focus-mode *:focus-within {
  filter: blur(0);
}

/* ============================================
   ALINEACIÓN DE TEXTO
   ============================================ */

.accessibility-text-left * {
  text-align: left;
}

.accessibility-text-center * {
  text-align: center;
}

.accessibility-text-right * {
  text-align: right;
}

.accessibility-text-justify * {
  text-align: justify;
}

/* ============================================
   BLOQUEAR ANIMACIONES
   ============================================ */

.accessibility-block-flashing *,
.accessibility-block-flashing *::before,
.accessibility-block-flashing *::after {
  animation: none;
  transition: none;
}

/* ============================================
   FUENTES ESPECIALES
   ============================================ */

.accessibility-dyslexia-font,
.accessibility-dyslexia-font * {
  font-family: 'OpenDyslexic', 'Comic Sans MS', Arial, sans-serif;
}

.accessibility-readable-font,
.accessibility-readable-font * {
  font-family: 'Arial', 'Helvetica', sans-serif;
  font-weight: 400;
}

/* ============================================
   LECTURA FÁCIL
   ============================================ */

.accessibility-easy-reading {
  font-size: 1.2rem;
  line-height: 1.8;
  word-spacing: 0.2em;
}

.accessibility-easy-reading p {
  margin-bottom: 1.5em;
}

/* ============================================
   MODO LECTURA
   ============================================ */

.accessibility-reading-mode {
  background: #f5f5dc;
  color: #000;
}

/* ============================================
   OCULTAR IMÁGENES
   ============================================ */

.accessibility-hide-images img,
.accessibility-hide-images video {
  visibility: hidden;
}

/* ============================================
   RESALTAR ELEMENTOS
   ============================================ */

.accessibility-highlight-links a {
  background-color: yellow;
  text-decoration: underline;
  font-weight: bold;
}

.accessibility-highlight-titles h1,
.accessibility-highlight-titles h2,
.accessibility-highlight-titles h3,
.accessibility-highlight-titles h4,
.accessibility-highlight-titles h5,
.accessibility-highlight-titles h6 {
  background-color: #ffeb3b;
  padding: 0.25em 0.5em;
  border-left: 4px solid #fbc02d;
}

/* ============================================
   SILENCIAR SONIDOS
   ============================================ */

.accessibility-mute-sounds audio,
.accessibility-mute-sounds video {
  opacity: 0.5;
  pointer-events: none;
}

/* ============================================
   FILTROS DE BRILLO - SIN !important
   ============================================ */

.accessibility-high-brightness {
  filter: brightness(130%);
}

.accessibility-low-brightness {
  filter: brightness(70%);
}

/* ============================================
   FILTROS DE CONTRASTE
   ============================================ */

.accessibility-high-contrast {
  filter: contrast(150%);
}

.accessibility-high-contrast *:not(button):not([aria-label*="Abrir panel"]) {
  border-width: 2px;
}

.accessibility-light-contrast {
  background: #ffffff;
  color: #000000;
}

.accessibility-light-contrast * {
  background: #ffffff;
  color: #000000;
}

.accessibility-inverted-contrast {
  filter: invert(1);
}

.accessibility-dark-contrast {
  background: #000000;
  color: #ffffff;
}

.accessibility-dark-contrast * {
  background: #000000;
  color: #ffffff;
}

/* ============================================
   FILTROS DE SATURACIÓN
   ============================================ */

.accessibility-monochrome {
  filter: grayscale(100%);
}

.accessibility-high-saturation {
  filter: saturate(200%);
}

.accessibility-low-saturation {
  filter: saturate(50%);
}

/* ============================================
   FILTROS DE DALTONISMO
   ============================================ */

.accessibility-colorblind-deuteranopia {
  filter: contrast(1.2) sepia(0.1) hue-rotate(10deg);
}

.accessibility-colorblind-deuteranomalía {
  filter: contrast(1.1) sepia(0.05) hue-rotate(5deg);
}

.accessibility-colorblind-protanopia {
  filter: contrast(1.2) sepia(0.15) hue-rotate(-10deg);
}

.accessibility-colorblind-tritanopia {
  filter: contrast(1.15) hue-rotate(180deg) saturate(0.8);
}

.accessibility-colorblind-tritanomalía {
  filter: contrast(1.1) hue-rotate(90deg) saturate(0.9);
}

.accessibility-colorblind-acromatopsia {
  filter: grayscale(100%) contrast(1.2);
}

/* ============================================
   PROTECCIÓN ABSOLUTA DEL BOTÓN FLOTANTE
   ============================================ */

/* Excluir botón de TODOS los efectos */
button[aria-label="Abrir panel de accesibilidad"],
button[aria-label="Abrir panel de accesibilidad"] *,
.accessibility-panel,
.accessibility-panel *,
[role="dialog"],
[role="dialog"] * {
  filter: none;
  backdrop-filter: none;
  transform: none;
  opacity: 1;
  animation: none;
}

/* Posición forzada del botón */
button[aria-label="Abrir panel de accesibilidad"] {
  position: fixed;
  bottom: 24px;
  right: 24px;
  z-index: 2147483647;
  pointer-events: auto;
}

/* Proteger del efecto lupa */
.accessibility-magnifier button[aria-label="Abrir panel de accesibilidad"]:hover {
  transform: none;
  scale: 1;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

/* Proteger del efecto focus */
.accessibility-focus-mode button[aria-label="Abrir panel de accesibilidad"] {
  filter: none;
}
